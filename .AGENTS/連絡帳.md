# 連絡帳

人間に確認OKをもらえたら作業内容を3行程度にまとめてここに記載してください

2024-05-31 Codex
フェイズ1の環境をVite+React+Tailwindで再構築しました。
Hello World表示用のsrc/App.tsxとエントリーポイントを作成しました。
READMEにセットアップ手順を追記し、動作確認は未実施です。

2025-10-04 Codex
フェイズ2着手としてSVGベースの4x4盤面コンポーネントと初期盤面データを実装しました。
TailwindのPostCSS設定を整備し、盤面とレイアウトを中央寄せで表示できるよう調整しました。

2025-10-04 Codex
デザイン仕様を反映し、チェス駒を絵文字表示・Base/Jailレイアウトを調整し、盤面の角丸を廃止しました。

2025-10-04 Codex
フェイズ3としてGameManager導入と手番・選択・移動ロジックを実装し、UIを連動。tsconfig調整とスタブ追加でビルドも通る状態です。

2025-10-04 Codex
Wait概念を追加し、捕虜解放後の1ターン待機処理を実装。Wait表示用コンポーネントを追加してUIにも反映しました。

2025-10-04 Codex
ゲームルール変更に合わせて初期配置の黒白位置を入れ替えました。

2025-10-04 Codex
複数コマ選択用ポップアップを盤面端でも表示できるよう方向切替を実装。捕虜解放時は即座にBaseへ戻る仕様へWait周りのロジックを再調整しました。

2025-10-04 Codex
ポップアップを盤面オーバーレイで再描画し、淡い灰色の背景に変更することで視認性を改善しました。

2025-10-04 Codex
盤面進行ロジックをsrc/game/rules.tsへ分離し、GameManagerはUI制御に専念。AIからも利用しやすい純粋APIへ整理しました。

2025-10-04 Claude
王手回避ロジックを実装しました。isInCheck関数をrules.tsに追加し、evaluator.tsで王手時に±5000点のペナルティを適用。
GameAI.tsで王手がかかっている場合は王手を回避しない手を違法手として除外し、AIが必ず王手から逃げるようになりました。

2025-10-04 Claude
相互王手時に相手の王を取らない問題を修正。王手回避チェックで勝利する手を除外対象から外し、相手の王を取れる場合は優先するようにしました。

2025-10-04 Claude
チェックメイト時の無限ループを修正。AIが合法手なしでmove: nullを返した場合、App.tsxで相手の勝利として確定させるようにしました。

2025-10-04 Claude
フェイズ5として難易度選択機能を実装。DifficultySelector.tsxを新規作成し、レベル1〜5（searchDepth: 1,2,4,6,8）を選択可能に。
初期レベルはレベル2、AI思考中以外はいつでも難易度変更できるようにしました。

2025-10-04 Claude
難易度変更をゲーム開始前のみに制限。moveCountを追加し、1手でも指したら難易度変更を無効化するようにしました。

2025-10-04 Claude
GitHub Pages用デプロイWorkflowを追加。vite.config.tsで環境変数により本番時のみbase設定を適用するようにしました。

2025-10-04 Claude
捕虜解放後の待機処理を修正。移動元での解放時と、敵コマがいない移動先での解放時にWait状態にするよう変更し、ルール通り解放直後は動けないようにしました。

2025-10-04 Claude
react-rewardsを使って勝敗演出を実装。人間勝利時は紙吹雪、AI勝利時は絵文字演出が画面中央から発生するようにしました。

2025-10-04 Claude
AI思考開始前に0.75秒の待機時間を追加。「AIが思考中です…」テキストをopacityで制御してレイアウトのガタつきを解消しました。

2025-10-04 Claude
フェイズ6として、ゲームスタート前の難易度選択ダイアログを実装。ルール説明、難易度選択（Lv.1〜5横並び）、投了ボタン、再プレイボタンを追加しました。ゲーム画面の難易度表示は選択不可のテキスト表示に変更。

2025-10-04 Claude
投了・再戦ボタンを難易度表示の右横に移動してレイアウトをコンパクトに調整しました。

2025-10-04 Claude
ルール説明を一元管理する共通コンポーネント（RulesDescription.tsx）を作成。開始ダイアログとゲーム画面の盤面直下で同じルール説明を表示するようにしました。

2025-10-04 Claude
捕虜コマの表示を改善。回転させたコマを横並びに配置するようJailComponent.tsxを修正しました。

2025-10-05 Claude
直前の手のハイライト表示を実装。GameManagerにlastMoveプロパティを追加し、移動先のセルを薄い黄色(rgb(250, 204, 21))で半透明表示するようにしました。

2025-10-05 Claude
駒のテキスト選択を無効化。PieceComponent.tsxのtext要素にuserSelect: 'none'を追加し、駒をクリックしても文字が選択されないようにしました。

2025-10-05 Claude
Noto Sans Symbols 2フォントを適用。index.cssで@font-faceを追加し、PieceComponent.tsxのfontFamilyで優先的に使用するよう設定しました。捕虜の回転を90度から270度に変更しました。

2025-10-05 Claude
WDXLL Lubrifont JPNフォントを追加。index.cssで@font-faceを定義し、App.tsxとStartDialog.tsxのタイトル部分に適用しました。

2025-10-05 Claude
コマの動きの説明セクションをRulesDescription.tsxに追加。4種類のコマの絵文字とその動きを横並びで表示し、日本語の自然な改行を実現しました。

2025-10-05 Claude
タイトル画像bloodless.pngを追加。App.tsxとStartDialog.tsxのタイトル横に表示。GitHub Pages対応のためimport文でパスを解決するよう修正しました。

2025-10-05 Claude
盤面をレスポンシブ対応。SVGのwidthとheightを100%にしてviewBoxで内部座標を維持することで、スマホでも適切なサイズで表示されるようにしました。

2025-10-05 Claude
全コンポーネントのコマの色を#0f172a（slate-950相当）に統一しました。

2025-10-05 Claude
i18nextとreact-i18nextを使って国際化対応を実装。日本語と英語に対応し、URLパラメータ(?lang=en/ja)またはブラウザ言語設定で自動切り替え。翻訳ファイルはsrc/locales/以下で管理しています。

2025-10-05 Claude
README.mdを英語化し、favicon設定を追加。public/favicon.pngに画像を配置してGitHub Pages対応しました。

2025-10-05 Claude
王手を受けているキングが震えるアニメーションを実装。isInCheck関数で王手状態を検出し、該当するキングにCSSアニメーション(shake)を適用しました。

2025-10-12 Codex
GameAI.decideの評価関数に盤面キャッシュを導入し、同一局面を再評価しないように最適化しました。
レベル5シナリオのテストで思考時間が約1.9秒から1.6秒程度まで短縮されたことを確認済みです。

2025-10-12 Codex
盤面シリアライズを共通化し、GameAI側にトランスポジションテーブルを追加しました。
レベル5シナリオの探索時間が約0.73秒まで短縮され、思考ロジックの挙動は従来通りです。

2025-10-12 Codex
勝敗決定後に盤面へ半透明オーバーレイで「White Wins! / Black Wins!」を表示。文字サイズを縮小し半透明にして、盤面からはみ出さず視認性を高めました。

2025-10-12 Codex
勝敗オーバーレイをクリックすると再戦処理（handleReplay）を呼ぶようにし、勝敗結果から即座にリプレイを開始できるようにしました。

2025-10-12 Codex
GameAIの合法手判定を強化し、自分のキングがチェックになる手を列挙段階で除外。ルールテストを追加して深い探索でも自玉を晒さないことを検証しました。

2025-10-12 Codex
評価関数でチェックメイト（相手に合法手が無い＆王手）を±10000点として扱うよう調整。即詰み局面をテストに追加し、AIが詰み手や王取りを確実に選択することを確認しました。

2025-10-12 Codex
resolveMoveでチェックメイト判定を追加し、王が捕縛されなくても勝敗が確定するよう修正。白が詰まされたケースでも黒勝利になることをルールテストで確認済みです。

2025-10-12 Codex
評価関数で相手をチェックしている場合に+5、自分がチェックされている場合に-5を反映し、思考ロジックの仕様と実装を同期させました。

2025-10-12 Codex
同一局面の出現回数を追跡し、三度現れた時点で引き分け判定・UI表示(重複回数のステータス、ドローオーバーレイ)を実装しました。ルールテストで三fold repetitionを検証しています。

2025-10-12 Codex
Negamaxの符号ミスマッチを解消し、評価関数が返す視点と探索の比較ロジックを一致させました。これによりレベル1でも駒得手（例: BK→WB捕獲）を正しく選択するようになります。

2025-10-12 Codex
解放された待機駒が1ターン待ってからBaseへ戻るよう処理を修正し、WAIT状態が勝敗判定に反映されない問題を解消しました。

2025-10-12 Codex
フェイズ7対応として先手/後攻の選択機能を追加。スタートダイアログにカラー選択ラジオを配置し、黒を選ぶと初期配置を指定の形へ入れ替え、AI手番も自動で切り替わるようにしました。

2025-10-12 Codex
ゲーム開始前の手動操作では盤面が動かないよう `gameStarted` フラグを導入し、AI思考もプレイボタン押下後にのみ走るよう制御しました。

2025-10-12 Codex
勝敗演出のDOMに `pointer-events: none` を付与し、リプレイ／投了ボタンが演出に遮られてクリックできなくなる問題を解消しました。

2025-10-12 Codex
駒の描画をframer-motionベースに刷新し、移動・捕獲のトランジションとクリック処理を両立しました。
待機・捕虜コマを共通レイヤーで管理して再表示し、捕虜はその場で90°回転させています。
ビルドで整合性を確認済みで、盤面上の操作と表示が期待どおりに動作することを手動確認しました。
